-- Fix search_path for all SECURITY DEFINER functions
-- This prevents search path manipulation attacks by explicitly setting the search path

-- Functions that need search_path set to 'public'
ALTER FUNCTION public.check_expired_consents() SET search_path = public;
ALTER FUNCTION public.handle_updated_at() SET search_path = public;
ALTER FUNCTION public.clean_old_contact_submissions() SET search_path = public;
ALTER FUNCTION public.cleanup_oauth_state() SET search_path = public;
ALTER FUNCTION public.get_recruiter_sport(uuid) SET search_path = public;
ALTER FUNCTION public.update_secret_rotation_due() SET search_path = public;
ALTER FUNCTION public.check_stat_update_reminders() SET search_path = public;
ALTER FUNCTION public.can_user_login(uuid) SET search_path = public;
ALTER FUNCTION public.get_engagement_stats(uuid, integer) SET search_path = public;
ALTER FUNCTION public.get_impersonated_user_id() SET search_path = public;
ALTER FUNCTION public.start_impersonation_session(uuid) SET search_path = public;
ALTER FUNCTION public.end_impersonation_session() SET search_path = public;
ALTER FUNCTION public.is_minor(date) SET search_path = public;
ALTER FUNCTION public.notify_expiring_consents() SET search_path = public;
ALTER FUNCTION public.check_duplicate_athlete(text, integer, text, text) SET search_path = public;
ALTER FUNCTION public.encrypt_oauth_token(text) SET search_path = public;
ALTER FUNCTION public.decrypt_oauth_token(bytea) SET search_path = public;
ALTER FUNCTION public.calculate_age(date) SET search_path = public;
ALTER FUNCTION public.get_membership_status(uuid) SET search_path = public;
ALTER FUNCTION public.generate_claim_token() SET search_path = public;
ALTER FUNCTION public.check_profile_upload_rate_limit() SET search_path = public;
ALTER FUNCTION public.get_evaluation_composite_score(jsonb) SET search_path = public;
ALTER FUNCTION public.log_offer_document_access() SET search_path = public;
ALTER FUNCTION public.update_promotion_history() SET search_path = public;
ALTER FUNCTION public.mark_secret_rotated(text, text) SET search_path = public;
ALTER FUNCTION public.get_secrets_needing_rotation() SET search_path = public;
ALTER FUNCTION public.get_least_featured_athletes(integer) SET search_path = public;
ALTER FUNCTION public.update_course_progress_timestamp() SET search_path = public;
ALTER FUNCTION public.get_daily_ai_usage() SET search_path = public;
ALTER FUNCTION public.check_ai_usage_thresholds() SET search_path = public;
ALTER FUNCTION public.check_video_completion_badges() SET search_path = public;
ALTER FUNCTION public.log_audit_event(text, text, uuid, jsonb) SET search_path = public;
ALTER FUNCTION public.notify_profile_viewed() SET search_path = public;
ALTER FUNCTION public.log_security_event(text, text, text, jsonb) SET search_path = public;
ALTER FUNCTION public.get_profile_view_stats(uuid, integer) SET search_path = public;
ALTER FUNCTION public.can_request_reevaluation(uuid) SET search_path = public;
ALTER FUNCTION public.get_evaluation_price(uuid) SET search_path = public;
ALTER FUNCTION public.get_blended_ranking_score(uuid, text, text, integer) SET search_path = public;
ALTER FUNCTION public.award_tutorial_badge() SET search_path = public;
ALTER FUNCTION public.get_user_tier(uuid) SET search_path = public;
ALTER FUNCTION public.get_user_evaluation_price(uuid, boolean) SET search_path = public;
ALTER FUNCTION public.increment_video_view_count() SET search_path = public;
ALTER FUNCTION public.has_feature_access(uuid, text) SET search_path = public;
ALTER FUNCTION public.get_safe_athlete_profile(uuid) SET search_path = public;
ALTER FUNCTION public.archive_user_data(uuid) SET search_path = public;
ALTER FUNCTION public.archive_media_file() SET search_path = public;
ALTER FUNCTION public.admin_get_archived_media(uuid, uuid, integer) SET search_path = public;
ALTER FUNCTION public.get_media_version_history(uuid) SET search_path = public;
ALTER FUNCTION public.archive_alumni_account(uuid) SET search_path = public;
ALTER FUNCTION public.link_pending_parent_verification() SET search_path = public;
ALTER FUNCTION public.validate_promo_code(text, text) SET search_path = public;
ALTER FUNCTION public.is_paid_recruiter(uuid) SET search_path = public;
ALTER FUNCTION public.update_updated_at_column() SET search_path = public;
ALTER FUNCTION public.has_role(uuid, app_role) SET search_path = public;
ALTER FUNCTION public.handle_new_user() SET search_path = public;
ALTER FUNCTION public.update_connected_accounts_updated_at() SET search_path = public;